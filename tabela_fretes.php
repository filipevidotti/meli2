<?php
// Tabela de fretes do Mercado Livre
$tabela_fretes = [
    // Região Sul/Sudeste/Centro-Oeste
    'sul_sudeste' => [
        // Produtos novos de menos de R$ 79, usados e Grátis no ML
        'abaixo_79' => [
            'full' => [
                '0.3' => 39.90,
                '0.5' => 42.90,
                '1' => 44.90,
                '2' => 46.90,
                '3' => 49.90,
                '4' => 53.90,
                '5' => 56.90,
                '9' => 88.90,
                '13' => 131.90,
                '17' => 146.90,
                '23' => 171.90,
                '30' => 197.90,
                '40' => 203.90,
                '50' => 210.90,
                '60' => 224.90,
                '70' => 240.90,
                '80' => 251.90,
                '90' => 279.90,
                '100' => 319.90,
                '125' => 357.90,
                '150' => 379.90,
                '999' => 498.90 // Maior que 150kg
            ],
            'outros' => [
                '0.3' => 39.90,
                '0.5' => 42.90,
                '1' => 44.90,
                '2' => 46.90,
                '3' => 49.90,
                '4' => 53.90,
                '5' => 56.90,
                '9' => 88.90,
                '13' => 131.90,
                '17' => 146.90,
                '23' => 171.90,
                '30' => 197.90,
                '40' => 203.90,
                '50' => 210.90,
                '60' => 224.90,
                '70' => 240.90,
                '80' => 251.90,
                '90' => 279.90,
                '100' => 319.90,
                '125' => 357.90,
                '150' => 379.90,
                '999' => 498.90 // Maior que 150kg
            ]
        ],
        // Produtos novos a partir de R$ 79 (50% de desconto)
        'acima_79' => [
            'full' => [
                '0.3' => 19.95,
                '0.5' => 21.45,
                '1' => 22.45,
                '2' => 23.45,
                '3' => 24.95,
                '4' => 26.95,
                '5' => 28.45,
                '9' => 44.45,
                '13' => 65.95,
                '17' => 73.45,
                '23' => 85.95,
                '30' => 98.95,
                '40' => 101.95,
                '50' => 105.45,
                '60' => 112.45,
                '70' => 120.45,
                '80' => 125.95,
                '90' => 139.95,
                '100' => 159.95,
                '125' => 178.95,
                '150' => 189.95,
                '999' => 249.45 // Maior que 150kg
            ],
            'outros' => [
                '0.3' => 19.95,
                '0.5' => 21.45,
                '1' => 22.45,
                '2' => 23.45,
                '3' => 24.95,
                '4' => 26.95,
                '5' => 28.45,
                '9' => 44.45,
                '13' => 65.95,
                '17' => 73.45,
                '23' => 85.95,
                '30' => 98.95,
                '40' => 101.95,
                '50' => 105.45,
                '60' => 112.45,
                '70' => 120.45,
                '80' => 125.95,
                '90' => 139.95,
                '100' => 159.95,
                '125' => 178.95,
                '150' => 189.95,
                '999' => 249.45 // Maior que 150kg
            ]
        ],
        // Categorias especiais (25% de desconto)
        'especial' => [
            'full' => [
                '0.3' => 29.93,
                '0.5' => 32.18,
                '1' => 33.68,
                '2' => 35.18,
                '3' => 37.43,
                '4' => 40.43,
                '5' => 42.68,
                '9' => 66.68,
                '13' => 98.93,
                '17' => 110.18,
                '23' => 128.93,
                '30' => 148.43,
                '40' => 152.93,
                '50' => 158.18,
                '60' => 168.68,
                '70' => 180.68,
                '80' => 188.93,
                '90' => 209.93,
                '100' => 239.93,
                '125' => 268.43,
                '150' => 284.93,
                '999' => 374.18 // Maior que 150kg
            ],
            'outros' => [
                '0.3' => 29.93,
                '0.5' => 32.18,
                '1' => 33.68,
                '2' => 35.18,
                '3' => 37.43,
                '4' => 40.43,
                '5' => 42.68,
                '9' => 66.68,
                '13' => 98.93,
                '17' => 110.18,
                '23' => 128.93,
                '30' => 148.43,
                '40' => 152.93,
                '50' => 158.18,
                '60' => 168.68,
                '70' => 180.68,
                '80' => 188.93,
                '90' => 209.93,
                '100' => 239.93,
                '125' => 268.43,
                '150' => 284.93,
                '999' => 374.18 // Maior que 150kg
            ]
        ]
    ],
    // Região Nordeste
    'nordeste' => [
        // Produtos novos de menos de R$ 79, usados e Grátis no ML
        'abaixo_79' => [
            'full' => [
                '0.3' => 39.90,
                '0.5' => 42.90,
                '1' => 44.90,
                '2' => 46.90,
                '3' => 49.90,
                '4' => 53.90,
                '5' => 56.90,
                '9' => 88.90,
                '13' => 131.90,
                '17' => 146.90,
                '23' => 171.90,
                '30' => 197.90,
                '40' => 203.90,
                '50' => 210.90,
                '60' => 224.90,
                '70' => 240.90,
                '80' => 251.90,
                '90' => 279.90,
                '100' => 319.90,
                '125' => 357.90,
                '150' => 379.90,
                '999' => 498.90 // Maior que 150kg
            ],
            'outros' => [
                '0.3' => 62.90,
                '0.5' => 68.10,
                '1' => 72.10,
                '2' => 85.70,
                '3' => 110.80,
                '4' => 118.40,
                '5' => 123.60,
                '9' => 138.30,
                '13' => 189.80,
                '17' => 250.10,
                '23' => 281.10,
                '30' => 293.40,
                '40' => 294.90,
                '50' => 296.90,
                '60' => 300.90,
                '70' => 308.90,
                '80' => 311.90,
                '90' => 332.90,
                '100' => 364.90,
                '125' => 390.90,
                '150' => 416.90,
                '999' => 546.10 // Maior que 150kg
            ]
        ],
        // Produtos novos a partir de R$ 79 (50% de desconto)
        'acima_79' => [
            'full' => [
                '0.3' => 19.95,
                '0.5' => 21.45,
                '1' => 22.45,
                '2' => 23.45,
                '3' => 24.95,
                '4' => 26.95,
                '5' => 28.45,
                '9' => 44.45,
                '13' => 65.95,
                '17' => 73.45,
                '23' => 85.95,
                '30' => 98.95,
                '40' => 101.95,
                '50' => 105.45,
                '60' => 112.45,
                '70' => 120.45,
                '80' => 125.95,
                '90' => 139.95,
                '100' => 159.95,
                '125' => 178.95,
                '150' => 189.95,
                '999' => 249.45 // Maior que 150kg
            ],
            'outros' => [
                '0.3' => 31.45,
                '0.5' => 34.05,
                '1' => 36.05,
                '2' => 42.85,
                '3' => 55.40,
                '4' => 59.20,
                '5' => 61.80,
                '9' => 69.15,
                '13' => 94.90,
                '17' => 125.05,
                '23' => 140.55,
                '30' => 146.70,
                '40' => 147.45,
                '50' => 148.45,
                '60' => 150.45,
                '70' => 154.45,
                '80' => 155.95,
                '90' => 166.45,
                '100' => 182.45,
                '125' => 195.45,
                '150' => 208.45,
                '999' => 273.05 // Maior que 150kg
            ]
        ],
        // Categorias especiais (25% de desconto)
        'especial' => [
            'full' => [
                '0.3' => 29.93,
                '0.5' => 32.18,
                '1' => 33.68,
                '2' => 35.18,
                '3' => 37.43,
                '4' => 40.43,
                '5' => 42.68,
                '9' => 66.68,
                '13' => 98.93,
                '17' => 110.18,
                '23' => 128.93,
                '30' => 148.43,
                '40' => 152.93,
                '50' => 158.18,
                '60' => 168.68,
                '70' => 180.68,
                '80' => 188.93,
                '90' => 209.93,
                '100' => 239.93,
                '125' => 268.43,
                '150' => 284.93,
                '999' => 374.18 // Maior que 150kg
            ],
            'outros' => [
                '0.3' => 47.18,
                '0.5' => 51.08,
                '1' => 54.08,
                '2' => 64.28,
                '3' => 83.10,
                '4' => 88.80,
                '5' => 92.70,
                '9' => 103.73,
                '13' => 142.35,
                '17' => 187.58,
                '23' => 210.83,
                '30' => 220.05,
                '40' => 221.18,
                '50' => 222.68,
                '60' => 225.68,
                '70' => 231.68,
                '80' => 233.93,
                '90' => 249.68,
                '100' => 273.68,
                '125' => 293.18,
                '150' => 312.68,
                '999' => 409.58 // Maior que 150kg
            ]
        ]
    ]
];

function calcularFrete($peso, $regiao_origem, $preco_final, $is_full, $is_categoria_especial, $estado_produto) {
    global $tabela_fretes;
    
    // Determinar a faixa de peso correta
    $faixa_peso = '999'; // Valor padrão para pesos acima de 150kg
    
    $faixas = [0.3, 0.5, 1, 2, 3, 4, 5, 9, 13, 17, 23, 30, 40, 50, 60, 70, 80, 90, 100, 125, 150, 999];
    
    foreach ($faixas as $faixa) {
        if ($peso <= $faixa) {
            $faixa_peso = (string) $faixa;
            break;
        }
    }
    
    // Determinar a faixa de preço (abaixo ou acima de R$79)
    $faixa_preco = ($preco_final < 79 || $estado_produto == 'usado') ? 'abaixo_79' : 'acima_79';
    
    // Se for categoria especial e o produto for novo, usar tabela especial
    if ($is_categoria_especial && $estado_produto == 'novo') {
        $faixa_preco = 'especial';
    }
    
    // Determinar se é Full ou Outros
    $tipo_servico = $is_full ? 'full' : 'outros';
    
    // Retornar o valor do frete
    return $tabela_fretes[$regiao_origem][$faixa_preco][$tipo_servico][$faixa_peso];
}
?>
